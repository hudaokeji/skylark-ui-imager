{"version":3,"sources":["plugins/history.js"],"names":["define","langx","noder","$","canvas2d","Imager","HistoryPlugin","Plugin","inherit","undoTransformations","init","imager","options","this","overrided","_initButtons","addEventListener","_onTranformationApplied","bind","undo","transformations","length","lastTransformation","pop","unshift","reinitializeImage","_updateButtons","redo","cancelTransformation","shift","push","buttonGroup","toolbar","createButtonGroup","backButton","createButton","image","disabled","forwardButton","disable","pluginInfo","name","ctor","installPlugin"],"mappings":";;;;;;;AAAAA,QACE,sBACA,sBACA,sBACA,yBACA,aACA,SAASC,EAAMC,EAAOC,EAAGC,EAASC,GAClC,YAEA,IAAIC,GAAeD,EAAOE,OAAOC,SAC9BC,oBAAqB,KAErBC,KAAO,SAASC,EAAOC,GACtBC,KAAKC,UAAUH,EAAOC,GACtBC,KAAKJ,uBACLI,KAAKE,eAELF,KAAKF,OAAOK,iBAAiB,sBAAuBH,KAAKI,wBAAwBC,KAAKL,QAGxFM,KAAM,WACJ,GAA2C,IAAvCN,KAAKF,OAAOS,gBAAgBC,OAAhC,CAIA,GAAIC,GAAqBT,KAAKF,OAAOS,gBAAgBG,KACrDV,MAAKJ,oBAAoBe,QAAQF,GAEjCT,KAAKF,OAAOc,oBACZZ,KAAKa,mBAGPC,KAAM,WACJ,GAAwC,IAApCd,KAAKJ,oBAAoBY,OAA7B,CAIA,GAAIO,GAAuBf,KAAKJ,oBAAoBoB,OACpDhB,MAAKF,OAAOS,gBAAgBU,KAAKF,GAEjCf,KAAKF,OAAOc,oBACZZ,KAAKa,mBAGPX,aAAc,WACZ,GAAIgB,GAAclB,KAAKF,OAAOqB,QAAQC,mBAetC,OAbApB,MAAKqB,WAAaH,EAAYI,cAC5BC,MAAO,OACPC,UAAU,IAGZxB,KAAKyB,cAAgBP,EAAYI,cAC/BC,MAAO,OACPC,UAAU,IAGZxB,KAAKqB,WAAWlB,iBAAiB,QAASH,KAAKM,KAAKD,KAAKL,OACzDA,KAAKyB,cAActB,iBAAiB,QAASH,KAAKc,KAAKT,KAAKL,OAErDA,MAGTa,eAAgB,WACdb,KAAKqB,WAAWK,QAAgD,IAAvC1B,KAAKF,OAAOS,gBAAgBC,QACrDR,KAAKyB,cAAcC,QAA6C,IAApC1B,KAAKJ,oBAAoBY,SAGvDJ,wBAAyB,WACvBJ,KAAKJ,uBACLI,KAAKa,oBAILc,GACFC,KAAO,UACPC,KAAOpC,EAKT,OAFAD,GAAOsC,cAAcH,GAEdA","file":"../../plugins/history.js","sourcesContent":["define([\n  \"skylark-langx/langx\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/query\",\n  \"skylark-utils-canvas2d\",\n  '../Imager',\n],function(langx,noder, $, canvas2d,Imager) {\n  'use strict';\n\n  var HistoryPlugin= Imager.Plugin.inherit({\n     undoTransformations: null,\n\n     init : function(imager,options) {\n      this.overrided(imager,options);\n      this.undoTransformations = [];\n      this._initButtons();\n\n      this.imager.addEventListener('core:transformation', this._onTranformationApplied.bind(this));\n    },\n\n    undo: function() {\n      if (this.imager.transformations.length === 0) {\n        return;\n      }\n\n      var lastTransformation = this.imager.transformations.pop();\n      this.undoTransformations.unshift(lastTransformation);\n\n      this.imager.reinitializeImage();\n      this._updateButtons();\n    },\n\n    redo: function() {\n      if (this.undoTransformations.length === 0) {\n        return;\n      }\n\n      var cancelTransformation = this.undoTransformations.shift();\n      this.imager.transformations.push(cancelTransformation);\n\n      this.imager.reinitializeImage();\n      this._updateButtons();\n    },\n\n    _initButtons: function() {\n      var buttonGroup = this.imager.toolbar.createButtonGroup();\n\n      this.backButton = buttonGroup.createButton({\n        image: 'undo',\n        disabled: true\n      });\n\n      this.forwardButton = buttonGroup.createButton({\n        image: 'redo',\n        disabled: true\n      });\n\n      this.backButton.addEventListener('click', this.undo.bind(this));\n      this.forwardButton.addEventListener('click', this.redo.bind(this));\n\n      return this;\n    },\n\n    _updateButtons: function() {\n      this.backButton.disable((this.imager.transformations.length === 0))\n      this.forwardButton.disable((this.undoTransformations.length === 0))\n    },\n\n    _onTranformationApplied: function() {\n      this.undoTransformations = [];\n      this._updateButtons();\n    }\n  });\n\n  var pluginInfo = {\n    name : \"history\",\n    ctor : HistoryPlugin\n  };\n\n  Imager.installPlugin(pluginInfo);\n\n  return pluginInfo;\n\n  \n});\n"]}