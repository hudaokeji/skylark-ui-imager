{"version":3,"sources":["plugins/history.js"],"names":["define","langx","noder","$","fabric","Darkroom","pluginInfo","name","ctor","Plugin","inherit","undoTransformations","init","options","this","overrided","_initButtons","addEventListener","_onTranformationApplied","bind","undo","transformations","length","lastTransformation","pop","unshift","reinitializeImage","_updateButtons","redo","cancelTransformation","shift","push","buttonGroup","toolbar","createButtonGroup","backButton","createButton","image","disabled","forwardButton","disable","installPlugin"],"mappings":";;;;;;;AAAAA,QACE,sBACA,qBACA,qBACA,iBACA,eACA,SAASC,EAAMC,EAAOC,EAAGC,EAAOC,GAChC,aAEA,IAiEIC,GACFC,KAAO,UACPC,KAnEiBH,EAASI,OAAOC,SAChCC,oBAAqB,KAErBC,KAAO,SAASP,EAASQ,GACxBC,KAAKC,UAAUV,EAASQ,GACxBC,KAAKH,uBACLG,KAAKE,eAELF,KAAKT,SAASY,iBAAiB,sBAAuBH,KAAKI,wBAAwBC,KAAKL,QAG1FM,KAAM,WACJ,GAA6C,IAAzCN,KAAKT,SAASgB,gBAAgBC,OAAlC,CAIA,IAAIC,EAAqBT,KAAKT,SAASgB,gBAAgBG,MACvDV,KAAKH,oBAAoBc,QAAQF,GAEjCT,KAAKT,SAASqB,oBACdZ,KAAKa,mBAGPC,KAAM,WACJ,GAAwC,IAApCd,KAAKH,oBAAoBW,OAA7B,CAIA,IAAIO,EAAuBf,KAAKH,oBAAoBmB,QACpDhB,KAAKT,SAASgB,gBAAgBU,KAAKF,GAEnCf,KAAKT,SAASqB,oBACdZ,KAAKa,mBAGPX,aAAc,WACZ,IAAIgB,EAAclB,KAAKT,SAAS4B,QAAQC,oBAexC,OAbApB,KAAKqB,WAAaH,EAAYI,cAC5BC,MAAO,OACPC,UAAU,IAGZxB,KAAKyB,cAAgBP,EAAYI,cAC/BC,MAAO,OACPC,UAAU,IAGZxB,KAAKqB,WAAWlB,iBAAiB,QAASH,KAAKM,KAAKD,KAAKL,OACzDA,KAAKyB,cAActB,iBAAiB,QAASH,KAAKc,KAAKT,KAAKL,OAErDA,MAGTa,eAAgB,WACdb,KAAKqB,WAAWK,QAAkD,IAAzC1B,KAAKT,SAASgB,gBAAgBC,QACvDR,KAAKyB,cAAcC,QAA6C,IAApC1B,KAAKH,oBAAoBW,SAGvDJ,wBAAyB,WACvBJ,KAAKH,uBACLG,KAAKa,qBAWT,OAFAtB,EAASoC,cAAcnC,GAEhBA","file":"../../plugins/history.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-fabric\",\r\n  '../Darkroom',\r\n],function(langx,noder, $, fabric,Darkroom) {\r\n  'use strict';\r\n\r\n  var HistoryPlugin= Darkroom.Plugin.inherit({\r\n     undoTransformations: null,\r\n\r\n     init : function(Darkroom,options) {\r\n      this.overrided(Darkroom,options);\r\n      this.undoTransformations = [];\r\n      this._initButtons();\r\n\r\n      this.Darkroom.addEventListener('core:transformation', this._onTranformationApplied.bind(this));\r\n    },\r\n\r\n    undo: function() {\r\n      if (this.Darkroom.transformations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      var lastTransformation = this.Darkroom.transformations.pop();\r\n      this.undoTransformations.unshift(lastTransformation);\r\n\r\n      this.Darkroom.reinitializeImage();\r\n      this._updateButtons();\r\n    },\r\n\r\n    redo: function() {\r\n      if (this.undoTransformations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      var cancelTransformation = this.undoTransformations.shift();\r\n      this.Darkroom.transformations.push(cancelTransformation);\r\n\r\n      this.Darkroom.reinitializeImage();\r\n      this._updateButtons();\r\n    },\r\n\r\n    _initButtons: function() {\r\n      var buttonGroup = this.Darkroom.toolbar.createButtonGroup();\r\n\r\n      this.backButton = buttonGroup.createButton({\r\n        image: 'undo',\r\n        disabled: true\r\n      });\r\n\r\n      this.forwardButton = buttonGroup.createButton({\r\n        image: 'redo',\r\n        disabled: true\r\n      });\r\n\r\n      this.backButton.addEventListener('click', this.undo.bind(this));\r\n      this.forwardButton.addEventListener('click', this.redo.bind(this));\r\n\r\n      return this;\r\n    },\r\n\r\n    _updateButtons: function() {\r\n      this.backButton.disable((this.Darkroom.transformations.length === 0))\r\n      this.forwardButton.disable((this.undoTransformations.length === 0))\r\n    },\r\n\r\n    _onTranformationApplied: function() {\r\n      this.undoTransformations = [];\r\n      this._updateButtons();\r\n    }\r\n  });\r\n\r\n  var pluginInfo = {\r\n    name : \"history\",\r\n    ctor : HistoryPlugin\r\n  };\r\n\r\n  Darkroom.installPlugin(pluginInfo);\r\n\r\n  return pluginInfo;\r\n\r\n  \r\n});\r\n"]}