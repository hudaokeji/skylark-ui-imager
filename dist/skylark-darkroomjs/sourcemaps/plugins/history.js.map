{"version":3,"sources":["plugins/history.js"],"names":["define","langx","noder","$","canvas2d","Imager","pluginInfo","name","ctor","Plugin","inherit","undoTransformations","init","imager","options","this","overrided","_initButtons","addEventListener","_onTranformationApplied","bind","undo","transformations","length","lastTransformation","pop","unshift","reinitializeImage","_updateButtons","redo","cancelTransformation","shift","push","buttonGroup","toolbar","createButtonGroup","backButton","createButton","image","disabled","forwardButton","disable","installPlugin"],"mappings":";;;;;;;AAAAA,QACE,sBACA,0BACA,0BACA,4BACA,aACA,SAASC,EAAMC,EAAOC,EAAGC,EAASC,GAClC,aAEA,IAiEIC,GACFC,KAAO,UACPC,KAnEiBH,EAAOI,OAAOC,SAC9BC,oBAAqB,KAErBC,KAAO,SAASC,EAAOC,GACtBC,KAAKC,UAAUH,EAAOC,GACtBC,KAAKJ,uBACLI,KAAKE,eAELF,KAAKF,OAAOK,iBAAiB,sBAAuBH,KAAKI,wBAAwBC,KAAKL,QAGxFM,KAAM,WACJ,GAA2C,IAAvCN,KAAKF,OAAOS,gBAAgBC,OAAhC,CAIA,IAAIC,EAAqBT,KAAKF,OAAOS,gBAAgBG,MACrDV,KAAKJ,oBAAoBe,QAAQF,GAEjCT,KAAKF,OAAOc,oBACZZ,KAAKa,mBAGPC,KAAM,WACJ,GAAwC,IAApCd,KAAKJ,oBAAoBY,OAA7B,CAIA,IAAIO,EAAuBf,KAAKJ,oBAAoBoB,QACpDhB,KAAKF,OAAOS,gBAAgBU,KAAKF,GAEjCf,KAAKF,OAAOc,oBACZZ,KAAKa,mBAGPX,aAAc,WACZ,IAAIgB,EAAclB,KAAKF,OAAOqB,QAAQC,oBAetC,OAbApB,KAAKqB,WAAaH,EAAYI,cAC5BC,MAAO,OACPC,UAAU,IAGZxB,KAAKyB,cAAgBP,EAAYI,cAC/BC,MAAO,OACPC,UAAU,IAGZxB,KAAKqB,WAAWlB,iBAAiB,QAASH,KAAKM,KAAKD,KAAKL,OACzDA,KAAKyB,cAActB,iBAAiB,QAASH,KAAKc,KAAKT,KAAKL,OAErDA,MAGTa,eAAgB,WACdb,KAAKqB,WAAWK,QAAgD,IAAvC1B,KAAKF,OAAOS,gBAAgBC,QACrDR,KAAKyB,cAAcC,QAA6C,IAApC1B,KAAKJ,oBAAoBY,SAGvDJ,wBAAyB,WACvBJ,KAAKJ,uBACLI,KAAKa,qBAWT,OAFAvB,EAAOqC,cAAcpC,GAEdA","file":"../../plugins/history.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-utils-dom/noder\",\r\n  \"skylark-utils-dom/query\",\r\n  \"skylark-graphics-canvas2d\",\r\n  '../Imager',\r\n],function(langx,noder, $, canvas2d,Imager) {\r\n  'use strict';\r\n\r\n  var HistoryPlugin= Imager.Plugin.inherit({\r\n     undoTransformations: null,\r\n\r\n     init : function(imager,options) {\r\n      this.overrided(imager,options);\r\n      this.undoTransformations = [];\r\n      this._initButtons();\r\n\r\n      this.imager.addEventListener('core:transformation', this._onTranformationApplied.bind(this));\r\n    },\r\n\r\n    undo: function() {\r\n      if (this.imager.transformations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      var lastTransformation = this.imager.transformations.pop();\r\n      this.undoTransformations.unshift(lastTransformation);\r\n\r\n      this.imager.reinitializeImage();\r\n      this._updateButtons();\r\n    },\r\n\r\n    redo: function() {\r\n      if (this.undoTransformations.length === 0) {\r\n        return;\r\n      }\r\n\r\n      var cancelTransformation = this.undoTransformations.shift();\r\n      this.imager.transformations.push(cancelTransformation);\r\n\r\n      this.imager.reinitializeImage();\r\n      this._updateButtons();\r\n    },\r\n\r\n    _initButtons: function() {\r\n      var buttonGroup = this.imager.toolbar.createButtonGroup();\r\n\r\n      this.backButton = buttonGroup.createButton({\r\n        image: 'undo',\r\n        disabled: true\r\n      });\r\n\r\n      this.forwardButton = buttonGroup.createButton({\r\n        image: 'redo',\r\n        disabled: true\r\n      });\r\n\r\n      this.backButton.addEventListener('click', this.undo.bind(this));\r\n      this.forwardButton.addEventListener('click', this.redo.bind(this));\r\n\r\n      return this;\r\n    },\r\n\r\n    _updateButtons: function() {\r\n      this.backButton.disable((this.imager.transformations.length === 0))\r\n      this.forwardButton.disable((this.undoTransformations.length === 0))\r\n    },\r\n\r\n    _onTranformationApplied: function() {\r\n      this.undoTransformations = [];\r\n      this._updateButtons();\r\n    }\r\n  });\r\n\r\n  var pluginInfo = {\r\n    name : \"history\",\r\n    ctor : HistoryPlugin\r\n  };\r\n\r\n  Imager.installPlugin(pluginInfo);\r\n\r\n  return pluginInfo;\r\n\r\n  \r\n});\r\n"]}